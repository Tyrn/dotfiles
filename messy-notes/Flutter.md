## Flutter
*A mobile application framework, Arch take*

- :snowflake: - supposedly obsolete entry.

### Misc

- Replace a word in all the files:
```
$ rg -w blerio --files-with-matches | xargs sed -i 's/blerio/bleriomob/g'
```

### Resources

- [Flutter state management solutions](https://fluttergems.dev/state-management/)

- [Most popular Flutter state management libraries in 2023](https://dev.to/mjablecnik/most-popular-flutter-state-management-libraries-in-2023-amc)

- [Vandad Nahavandipoor's Flutter video course](https://www.youtube.com/playlist?list=PL6yRaaP0WPkVtoeNIGqILtRAgd3h2CNpT),
[GitHub](https://github.com/vandadnp),
[Flutter Tips and Tricks](https://github.com/vandadnp/flutter-tips-and-tricks)

- [Understanding null safety](https://dart.dev/null-safety/understanding-null-safety)

- [Awesome Flutter on GitHub](https://github.com/Solido/awesome-flutter)

- [Flutter Awesome](https://flutterawesome.com/)

- [Awesome Flutter](https://awesomeflutter.com/)

- [Flutter Internals](https://www.didierboelens.com/2019/09/flutter-internals/)

- [Flutter by Example](https://flutterbyexample.com/)

- [Material components widgets](https://docs.flutter.dev/development/ui/widgets/material)

- [Flutter Architecture, official samples](https://github.com/brianegan/flutter_architecture_samples)

- [Flutter Planets](https://github.com/sergiandreplace/flutter_planets_tutorial) :snowflake:

- [Внедрение зависимостей (Dependency Injection) с GetIt во Flutter](https://habr.com/ru/company/rshb/blog/564158/)

- [Flutter widgets cheat sheet](https://blog.codemagic.io/flutter-widget-cheat-sheet/)

- [A beginner’s guide to go_router in Flutter](https://blog.codemagic.io/flutter-go-router-guide/)

- [Katz, Moore & Ngo, source](https://github.com/kodecocodes/flta-materials)

- [Bueno & Palcar, source](https://github.com/kodecocodes/rwf-materials)

- [dartdoc, Dart documentation generator](https://stackoverflow.com/questions/64602658/what-is-the-macro-annotation-in-flutter-and-dart-documentation)

- [json_serializable, code generation](https://pub.dev/packages/json_serializable)

- [Dhruv Nakum, GitHub](https://github.com/red-star25)

- [Dhruv Nakum, site](https://dhruvnakum.xyz/)

#### Creator

- [Xianzhe Liang - Create a Flutter state management library with 100 lines of code](https://medium.com/@xianzhe/create-a-flutter-state-management-library-with-100-lines-of-code-e80bd865f4bd),
[creator](https://github.com/liangxianzhe/creator)

#### Riverpod

- [Docs v2 (dev)](https://docs-v2.riverpod.dev/)

- [Rody Davis, Riverpod](https://github.com/rodydavis/flutter_todo_app), [Video](https://www.youtube.com/live/WvGHJef7O-g?feature=share)

- [Andrea Bizzotto - Flutter Riverpod 2.0: The Ultimate Guide](https://codewithandrea.com/articles/flutter-state-management-riverpod/)

- [Andrea Bizzotto - How to Auto-Generate your Providers with Flutter Riverpod Generator](https://codewithandrea.com/articles/flutter-riverpod-generator/)

- [Andrea Bizzotto - How to use Notifier and AsyncNotifier with the new Flutter Riverpod Generator](https://codewithandrea.com/articles/flutter-riverpod-async-notifier/)

- [Andrea Bizzotto - Use AsyncValue](https://codewithandrea.com/articles/flutter-use-async-value-not-future-stream-builder/)

- [Migrate StreamProvider from Provider to Riverpod](https://www.reddit.com/r/flutterhelp/comments/13z9kn1/provider_streamprovider_how_to_migrate_to_riverpod/)

#### BLoC

- [Biplab Dutta - A Taste of Reactive Programming in Flutter with RxDart and flutter_bloc](https://dev.to/b_plab98/a-taste-of-reactive-programming-in-flutter-with-rxdart-and-flutterbloc-3p12)

- [Didier Boelens - Reactive Programming, BLoC and Streams (rxdart only!)](https://www.didierboelens.com/blog/en/reactive-programming-streams-bloc),
[GitHub](https://github.com/boeledi/Streams-Block-Reactive-Programming-in-Flutter)

- [Bloc Library, including Examples](https://bloclibrary.dev); [on GitHub](https://github.com/felangel/bloc)

- [About `Future<void> main() async {}`](https://stackoverflow.com/questions/56129121/good-or-bad-declaring-main-method-async-in-dart-flutter)

- [Bloc & Cubit, +Video 2018](https://resocoder.com/2020/08/04/flutter-bloc-cubit-tutorial/)

- [BLoC and Bluetooth BLE](https://lupyuen.github.io/pinetime-rust-mynewt/articles/bloc)

- [EZ Flutter](https://github.com/Ephenodrom/EZ-Flutter)

- [Unit testing with BLoC](https://medium.com/flutter-community/unit-testing-with-bloc-b94de9655d86)

- [`mapEventToState()` deprecated](https://blog.logrocket.com/introduction-flutter-bloc-8/)

- [Lessons learned from switching Flutter app from Provider to Bloc — part I](https://urgo.medium.com/lessons-learned-from-switching-flutter-app-from-provider-to-bloc-part-i-96a301962849)

- [Lessons learned from switching Flutter app from Provider to Bloc — part II](https://urgo.medium.com/lessons-learned-from-switching-flutter-app-to-bloc-part-ii-63bac496435a)

- Lessons in Russian, [Video](https://youtu.be/khuaUejT3zw),
[47](https://github.com/JonFir/lazyload_flutter/tree/lesson/47-build-context),
[48](https://github.com/JonFir/lazyload_flutter/tree/lesson/48-inherited-widgets),
[78](https://github.com/JonFir/lazyload_flutter/tree/arch/lesson/78-provider),
[91](https://github.com/JonFir/lazyload_flutter/tree/arch/lesson/91-bloc-on-events),
[92](https://github.com/JonFir/lazyload_flutter/tree/arch/lesson/92-bloc-libs-cubit),
[93](https://github.com/JonFir/lazyload_flutter/tree/arch/lesson/93-bloc-libs-bloc),
[94](https://github.com/JonFir/lazyload_flutter/tree/arch/lesson/94-bloc-libs-flutter-bloc),
[95](https://github.com/JonFir/lazyload_flutter/tree/arch/lesson/95-bloc-libs-flutter-bloc-observer),
[103](https://github.com/JonFir/lazyload_flutter/tree/arch/lesson/103-dependency-managemant-sl),
[104](https://github.com/JonFir/lazyload_flutter/tree/arch/lesson/104-dependency-managemant-get_it)

- [bloc_event_transformers, transformer:, debounce](https://stackoverflow.com/questions/71054791/how-to-debounce-events-in-bloc)

- [bloc_concurrency, transformer:, debounce](https://stackoverflow.com/questions/62972731/flutter-transform-flutter-bloc-event-to-add-debounce)

- [Flutter: BLOCs at Scale | 1 — The State Machine](https://itnext.io/flutter-blocs-at-scale-1-the-state-machine-fce5f086d7b9)

- [Flutter: BLOCs at Scale | 2 — Keeping BLOCs Lean](https://itnext.io/flutter-blocs-at-scale-2-keeping-blocs-lean-1b659536e3ec)

- [Konstantin Kokorin - Freezed and Bloc 1/2 (ru)](https://youtu.be/J5W5ebOKTxY), [source](https://github.com/Virer2013/Learn_Flutter/tree/master/freezed_example)

- [Konstantin Kokorin - Freezed and Bloc 2/2 (ru)](https://youtu.be/viQX4T2TNb8), [source](https://github.com/Virer2013/Learn_Flutter/tree/master/bloc_freezed_example)

- [freezed_weather (hydrated_bloc, too)](https://github.com/yh-luo/freezed_weather)

- [Why Bloc + Freezed is a match made in heaven (counter)](https://dev.to/ptrbrynt/why-bloc-freezed-is-a-match-made-in-heaven-29ai)

- [Dash Tips: Using Freezed with Bloc (counter, better yet)](https://poetryincode.dev/dash-tips-using-freezed-with-bloc)

- [Testing Bloc with Mockito | Part-2](https://www.nahitfidanci.com/blog/testing-bloc-with-mockito-part-2?utm_source=nahitfidanci&utm_medium=referral&utm_campaign=flutter_bloc_tests_article&utm_content=article_on_nahitfidanci_blog)

- [Routers](https://dhruvnakum.xyz/most-popular-routing-packages-in-flutter)

- [AutoRouter](https://www.coletiv.com/blog/flutter-navigator-2.0-made-easy-with-auto-router/)

#### Very Good CLI

- [On pub.dev](https://pub.dev/packages/very_good_cli)

- [Flutter Todos Tutorial](https://bloclibrary.dev/#/fluttertodostutorial)

- [Testing](https://verygood.ventures/blog/flutter-tests-very-good-cli)

- [development/staging/production](https://verygood.ventures/blog/flutter-starter-app-very-good-core-cli)

- Install/upgrade:
```
$ dart pub global activate very_good_cli
...
$ dart pub global list
```

#### Create a Hello project

- Use Very Good CLI:
```
$ very_good create flutter_app very_hello
$ cd very_hello
```
- Add Linux platform:
```
$ flutter create --platforms=linux .
```
- Remove standard boilerplate; new `lib/main.dart`:
```
import 'package:very_hello/main_development.dart' as development;
import 'package:very_hello/main_production.dart' as production;
import 'package:very_hello/main_staging.dart' as staging;

void main() {
  return development.main();
}
```
- Remove error from `test/widget_test.dart`:
```
import 'package:very_hello/app/app.dart';
...
    await tester.pumpWidget(const App());
```
- Add to `dependencies` (`$ flutter pub add`):
```
  auto_route:
  flutter_rx_bloc:
  window_size:
    git:
      url: https://github.com/google/flutter-desktop-embedding.git
      path: plugins/window_size
      ref: 6c66ad23ee79749f30a8eece542cf54eaf157ed8
```
- Add to `dev_dependencies` (`$ flutter pub add -d`):
```
  import_sorter:
  auto_route_generator:
  build_runner:
```
- [Import sorter](https://pub.dev/packages/import_sorter) usage:
```
$ flutter pub run import_sorter:main
```
- Create `lib/platform.dart`:
```
import 'package:flutter/foundation.dart';

class Platform {
  static bool get isDesktop {
    return isLinux || isMacOS || isWindows;
  }

  static bool get isLinux {
    return defaultTargetPlatform == TargetPlatform.linux;
  }

  static bool get isMacOS {
    return defaultTargetPlatform == TargetPlatform.macOS;
  }

  static bool get isWindows {
    return defaultTargetPlatform == TargetPlatform.windows;
  }

  static bool get isFuchsia {
    return defaultTargetPlatform == TargetPlatform.fuchsia;
  }

  static bool get isAndroid {
    return defaultTargetPlatform == TargetPlatform.android;
  }

  static bool get isIOS {
    return defaultTargetPlatform == TargetPlatform.iOS;
  }
}
```

#### Localization

- [Flutter Intl plugin for Android Studio](https://stackoverflow.com/questions/73375594/flutter-intl-plugin-how-to-set-location-of-l10n-directory-that-is-generated)

- [Intl Utils](https://pub.dev/packages/intl_utils)
```
$ dart pub global activate intl_utils
$ dart pub global run intl_utils:generate
```

#### Crossplatform build

- Create (add) Linux project:
```
my_project $ flutter create --platforms=linux .
```
- [Building Linux apps with Flutter](https://docs.flutter.dev/development/platform-integration/linux/building)

- [Native vs Host](https://wiki.loliot.net/docs/lang/flutter/engine/flutter-app-for-linux-arm64/)

- [Issue #74929](https://github.com/flutter/flutter/issues/74929)

- [eLinux](https://github.com/sony/flutter-elinux)

#### Rx Bloc

- [Main Page and Docs](https://github.com/Prime-Holding/rx_bloc)

- [Rx Bloc CLI](https://pub.dev/packages/rx_bloc_cli)

- [build_runner](https://pub.dev/packages/build_runner)

- [RxDart Network Samples](https://github.com/apgapg/rx_dart_samples)

#### Bluetooth BLE

- [flutter-reactive-ble-example](https://github.com/ubiqueIoT/flutter-reactive-ble-example)

#### Kotlin upgrade (2023-03-28)

- [Kotlin release details](https://kotlinlang.org/docs/releases.html#release-details)

- `android/build.gradle`:
```
...
buildscript {
    ext.kotlin_version = '1.8.10'  // Change!
    repositories {
        google()
        mavenCentral()
    }

    dependencies {
        classpath 'com.android.tools.build:gradle:7.2.0'  // Change!
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
    }
}
...
```
- `android/gradle/wrapper/gradle-wrapper.properties`:
```
#Fri Jun 23 08:50:38 CEST 2017
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-7.5-all.zip  // Change!
```
- `android/app/build.gradle`:
```
...
    defaultConfig {
        // TODO: Specify your own unique Application ID (https://developer.android.com/studio/build/application-id.html).
        applicationId "com.example.stream_provider_ble"
        // minSdkVersion flutter.minSdkVersion
        minSdkVersion 21  // Change!
        targetSdkVersion flutter.targetSdkVersion
        versionCode flutterVersionCode.toInteger()
        versionName flutterVersionName
    }
...
```

#### Redux :snowflake:

[Flutter Redux](https://github.com/brianegan/flutter_redux)

[Redux & testing Hello World](https://github.com/xrigau/todo_demo_flutter_redux); [Shopping Cart](https://github.com/pszklarska/FlutterShoppingCart); [Simplified one](https://github.com/csnguyen-gmail/flutter_redux_architecture)

[Official Redux example](https://github.com/brianegan/flutter_architecture_samples/tree/master/example/redux)

### Installation (mostly :snowflake:)

- [Flutter on Linux](https://flutter.io/setup-linux/):
```
$ mkdir ~/mobile
$ cd ~/mobile
$ tar xf ~/Downloads/flutter_linux_v0.5.1-beta.tar.xz
$ export PATH=`pwd`/flutter/bin:$PATH
```
- Install toolchain components:
```
$ yaourt -S gradle android-sdk android-sdk-build-tools android-sdk-platform-tools android-platform
```
- Check:
```
$ cat /etc/profile.d/android-sdk-platform-tools.sh 
export PATH="${PATH}:/opt/android-sdk/platform-tools"
```
- Add to `.profile`:
```
export ANDROID_HOME=/opt/android-sdk
export PATH=$PATH:/home/alexey/mobile/flutter/bin
```
- Relax permissions for Android SDK:
```
$ sudo groupadd sdkusers
$ sudo gpasswd -a $USER sdkusers
$ sudo chown -R :sdkusers /opt/android-sdk/
$ sudo chmod -R g+w /opt/android-sdk/
```
[or just like this](https://dev.to/kaysoohyun/install-flutter-vscode-on-linux-successfully-2hpg):
```
$ sudo chown -R $USER /opt/flutter
```
- Accept licenses:
```
$ flutter doctor --android-licenses

```
- Check:
```
$ ls -l /opt/android-sdk/
total 24
drwxrwxr-x 2 root   sdkusers 4096 Oct  2  2017 add-ons
drwxrwxr-x 3 root   sdkusers 4096 Oct 28 13:03 build-tools
drwxr-xr-x 2 alexey users    4096 Oct 28 13:07 licenses
drwxrwxr-x 3 root   sdkusers 4096 Oct 28 13:02 platforms
drwxrwxr-x 5 root   sdkusers 4096 Oct 28 13:05 platform-tools
drwxrwxr-x 6 root   sdkusers 4096 Oct 28 13:05 tools

```
- Upgrade whenever you wish:
```
$ flutter upgrade
```

### Workflow

- Create project:
```
$ flutter create my_project
$ cd my_project
```
- Check your toolchain and target device:
```
$ flutter doctor -v
```
Never mind Android Studio: it is not mandatory after all.

- Install dependencies (according to `pubspec.yaml`):
```
$ flutter packages get
```
- Upgrade dependencies:
```
$ flutter packages upgrade
```
- Check installed dependencies:
```
$ flutter pub pub deps
```
- Build and run:
```
$ flutter run
```

### Troubleshooting

- [Got a stack frame from package:stack_trace, where a vm or web frame was expected](https://stackoverflow.com/questions/73591769/got-a-stack-frame-from-packagestack-trace-where-a-vm-or-web-frame-was-expected)

- [Bad state: Stream has already been listened to](https://stackoverflow.com/questions/51396769/flutter-bad-state-stream-has-already-been-listened-to)

:snowflake:

- `Error retrieving device properties for ro.product.cpu.abi Permission denied...`
Check your target Android device settings; replug.

- Wrong Android API version. Change `android/defaultConfig/minSdkVersion` in `my_project/android/app/build.gradle` (once) generated file.

- `adb` permissions error:
```
Error retrieving device properties for ro.product.cpu.abi:
error: insufficient permissions for device
See [http://developer.android.com/tools/device.html] for more information
```
Kill (start, if appropriate) the `adb`.
```
$ adb kill-server
($ sudo adb start-server)
```
Keep your Android device USB settings as MTP (Files).

- Trouble (2018-10-28) with `~/mobile/flutter/packages/flutter_tools/gradle/flutter.gradle`: [add google() to buildscript repositories](https://github.com/flutter/flutter/issues/23095)

